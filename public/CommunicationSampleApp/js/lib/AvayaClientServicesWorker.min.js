self.AvayaClientServicesWorker={},function(a){"use strict";function b(a,b,c){this._blocksGenerator=a,this._blocksComparator=b,this._blocksMerger=c,this._config=void 0,this._previousBlocks=[],this._generatingKeyFrame=!0,this._previousWidth=-1,this._previousHeight=-1,this._generatedFrames=0}b.prototype={setKeyFrameGeneration:function(a){this._generatingKeyFrame=a},generateChangedBlocks:function(a,b,c,d){var e={};this._config=b,this._determineKeyFrameGeneration(c,d);var f=Date.now();a=this._prepareScreen(a),e.prepareScreenTime=Date.now()-f,this._generatingKeyFrame?(this._previousBlocks=[],this._generatingKeyFrame=!1,e.isKeyFrame=!0):e.isKeyFrame=!1,f=Date.now();var g=this._determineChangedBlocks(a,c);return e.determineChangedBlocksTime=Date.now()-f,g.length>0&&(f=Date.now(),g=this._blocksMerger.mergeBlocks(g,this._mergeByRow.bind(this)),e.mergeBlocksTime=Date.now()-f,this._generatedFrames++),{changedBlocks:g,meta:e}},_determineKeyFrameGeneration:function(a,b){this._generatedFrames===this._config.framesPerKeyFrame&&(this._generatingKeyFrame=!0,this._generatedFrames=0),a===this._previousWidth&&b===this._previousHeight||(this._previousWidth=a,this._previousHeight=b,this._generatingKeyFrame=!0)},_determineChangedBlocks:function(a,b){var c=this._blocksGenerator.generateBlocks(this._config.blockSize,this._config.blockSize,a,b,this._prepareBlockData.bind(this));return c=this._blocksComparator.compareBlocks(this._previousBlocks,c,this._config.blockSize,this._config.blockSize,this._config.losslessColorLimit,this._prepareBuffer.bind(this))},_prepareScreen:function(){},_prepareBlockData:function(){},_prepareBuffer:function(){},_mergeByRow:function(){}},a.AbstractDataManipulator=b}(self.AvayaClientServicesWorker),function(a){"use strict";function b(){}b.prototype={compareBlocks:function(a,b,c,d,e,f){for(var g=[],h=b.length,i=0;i<h;i++){a[i]=a[i]||[];for(var j=b[i].length,k=0;k<j;k++)this._compareBlock(a,b[i][k],g,k,i,c,d,e,f)}return g},_compareBlock:function(a,b,c,d,e,f,g,h,i){for(var j="",k=b.data.length,l=0;l<k;l++)j+=btoa(b.data[l]);var m=a[e][d];if(!m||j!==m.base64){var n={_width:b.width,_height:b.data.length,_x:e*f,_y:d*g,_row:d,_column:e,_blocks:[],_data:b.data};n._type=this._determineType(n._data,h,i),c.push(n),a[e][d]={base64:j}}},_determineType:function(a,b,c){for(var d,e,f,g={},h=0,i=a.length,j=0;j<i;j++)for(d=c(a[j]),f=d.length,e=0;e<f;e++){var k=""+(16777215&d[e]);if(g[k]||(g[k]=0,h++),h>b)return 0;g[k]++}return 1}},a.BlocksComparator=b}(self.AvayaClientServicesWorker),function(a){"use strict";function b(){}b.prototype={generateBlocks:function(a,b,c,d,e){for(var f=[],g=c.length,h=4*d,i=4*a,j=0,k=0;j<g;j+=h,k++)for(var l=Math.floor(k/b),m=0;m<h;m+=i){var n=i;m+n>h&&(n=h-m);var o=Math.floor(m/i);f[o]||(f[o]=[]);var p=f[o][l]||{data:[],width:n/4};p.data=e(p,c.slice(j+m,j+m+n)),f[o][l]=p}return f}},a.BlocksGenerator=b}(self.AvayaClientServicesWorker),function(a){"use strict";function b(){}b.prototype={mergeBlocks:function(a,b){return a=this._sortByRow(a),a=this._mergeByRow(a,b),a=this._sortByColumn(a),a=this._mergeByColumn(a),a.map(this._createMergedBlock)},_sortByColumn:function(a){return a.sort(function(a,b){return a._column===b._column?a._row-b._row:a._column-b._column})},_sortByRow:function(a){return a.sort(function(a,b){return a._row===b._row?a._column-b._column:a._row-b._row})},_compareBlocksByColumn:function(a,b){return a._x===b._x&&a._type===b._type&&a._width===b._width&&(a._y+a._height===b._y||b._y+b._height===a._y)},_compareBlocksByRow:function(a,b){return a._y===b._y&&a._type===b._type&&a._height===b._height&&(a._x+a._width===b._x||b._x+b._width===a._x)},_merge:function(a,b,c){for(var d=[],e=this._copyBlock(a[0]),f=1;f<a.length;f++)b(e,a[f])?(a[f]._blocks.length>0?this._copyBlocks(a,f,e):e._blocks.push(a[f]),c(e,a[f])):(d.push(e),e=this._copyBlock(a[f]));return d.push(e),d},_mergeByColumn:function(a){return this._merge(a,this._compareBlocksByColumn,function(a,b){a._height+=b._height,a._data=a._data.concat(b._data)})},_mergeByRow:function(a,b){return this._merge(a,this._compareBlocksByRow,function(a,c){b(a,c),a._width+=c._width})},_copyBlocks:function(a,b,c){a[b]._blocks.forEach(function(a){c._blocks.push(a)})},_copyBlock:function(a){var b;return 0===a._blocks.length?(b={_x:a._x,_y:a._y,_row:a._row,_column:a._column,_width:a._width,_height:a._height,_type:a._type,_blocks:[],_data:a._data},b._blocks.push(a)):b=a,b},_createMergedBlock:function(a){var b=a._data.reduce(function(a,b){return Array.prototype.push.apply(a,b),a},[]),c=new ImageData(new Uint8ClampedArray(b),a._width,a._height);return{_x:a._x,_y:a._y,_row:a._row,_column:a._column,_width:a._width,_height:a._height,_type:a._type,_imgData:c}}},a.BlocksMerger=b}(self.AvayaClientServicesWorker),function(a){"use strict";function b(b,c,d){a.AbstractDataManipulator.call(this,b,c,d)}b.prototype=Object.create(a.AbstractDataManipulator.prototype),b.prototype._prepareScreen=function(a){return a},b.prototype._prepareBlockData=function(a,b){return a.data=a.data.concat(b),a.data},b.prototype._prepareBuffer=function(a){return new Uint32Array(a.buffer)},b.prototype._mergeByRow=function(a,b){for(var c=Math.ceil(a._width/this._config.blockSize),d=0;d<b._data.length;d++)Array.prototype.splice.apply(a._data,[c+(c+1)*d,0].concat(b._data[d]))},a.ChromeDataManipulator=b}(self.AvayaClientServicesWorker),function(a){"use strict";function b(){this._screenScraper=void 0}b.prototype={getDataManipulator:function(b){if(this._screenScraper)return this._screenScraper;var c=new a.BlocksGenerator,d=new a.BlocksComparator,e=new a.BlocksMerger;return"chrome"===b?this._screenScraper=new a.ChromeDataManipulator(c,d,e):"firefox"===b&&(this._screenScraper=new a.FirefoxDataManipulator(c,d,e)),this._screenScraper}},a.DataManipulatorFactory=b}(self.AvayaClientServicesWorker),function(a){"use strict";function b(b,c,d){a.AbstractDataManipulator.call(this,b,c,d)}b.prototype=Object.create(a.AbstractDataManipulator.prototype),b.prototype._prepareScreen=function(a){return Array.prototype.slice.call(a,0)},b.prototype._prepareBlockData=function(a,b){return a.data.push(b),a.data},b.prototype._prepareBuffer=function(a){return new Uint32Array(a)},b.prototype._mergeByRow=function(a,b){for(var c=Math.ceil(a._width/this._config.blockSize),d=0;d<b._data.length;d++)Array.prototype.splice.apply(a._data,[c+(c+1)*d,0,b._data[d]])},a.FirefoxDataManipulator=b}(self.AvayaClientServicesWorker),function(a){"use strict";var b={INITIALIZE:"initialize",CHANGED_BLOCKS:"changedBlocksMessage",SEND_IMAGE_DATA:"wholeImgData",WORKER_STARTED:"workerStarted"};a.ScreenCapturerWorkerEvents=b}(self.AvayaClientServicesWorker),function(a){"use strict";var b,c,d=new a.DataManipulatorFactory;self.onmessage=function(e){if(e.data.type===a.ScreenCapturerWorkerEvents.INITIALIZE)b=d.getDataManipulator(e.data.browser),c=e.data.config,self.postMessage({type:a.ScreenCapturerWorkerEvents.WORKER_STARTED});else if(e.data.type===a.ScreenCapturerWorkerEvents.SEND_IMAGE_DATA){var f=Date.now();e.data.forceKeyFrame&&b.setKeyFrameGeneration(!0);var g=b.generateChangedBlocks(e.data.imgData,c,e.data.width,e.data.height),h=g.changedBlocks.map(function(a){return a._imgData.data.buffer}),i={processingTime:Date.now()-f,processedBlocks:g.changedBlocks.length,keyFrame:g.meta.isKeyFrame,meta:g.meta,generatedPNGs:g.changedBlocks.reduce(function(a,b){return 1===b._type&&a++,a},0)};self.postMessage({type:a.ScreenCapturerWorkerEvents.CHANGED_BLOCKS,data:g.changedBlocks,meta:i},h)}}}(self.AvayaClientServicesWorker);