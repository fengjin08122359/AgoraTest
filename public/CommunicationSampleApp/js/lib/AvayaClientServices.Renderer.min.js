!function(a){"use strict";!function(a){a=a||{}}(a),function(a){a.Renderer=a.Renderer||{}}(a),function(a){a.Renderer.Konva=a.Renderer.Konva||{}}(a)}(AvayaClientServices),function(a){"use strict";function b(){this._contentSharing=void 0}b.prototype={init:function(a,b){this._contentSharing=a,a.addOnCursorReceivedCallback(function(a,b){this.showCursor(b)}.bind(this)),a.addOnContentSharingStartedCallback(function(a,c){this.start(b)}.bind(this)),a.addOnContentSharingEndedCallback(function(a,b){this.stop()}.bind(this)),a.addOnContentSharingPausedCallback(function(a,b){this.pause()}.bind(this)),a.addOnContentSharingResumedCallback(function(a,b){this.unpause()}.bind(this)),a.addOnFrameReceivedCallback(function(a,b){this.drawFrame(b)}.bind(this)),a.addOnFrameChangedCallback(function(a,b){this.drawFrame(b)}.bind(this))},showCursor:function(a){},start:function(){},stop:function(){},pause:function(){},unpause:function(){},drawFrame:function(a){}},a.Renderer.ContentSharingRenderer=b}(AvayaClientServices),function(a){"use strict";function b(){this._state=a.Renderer.Konva.KonvaContentSharingState.STOPPED,this._width=0,this._height=0,this._cursor=void 0,Konva.pixelRatio=1,this._drawingLayer=new Konva.FastLayer,this._zoomLayer=new Konva.FastLayer,this._mainLayer=new Konva.FastLayer,this._cursorLayer=new Konva.FastLayer,this._pauseLayer=new Konva.FastLayer,this._drawingStage=void 0,this._zoomStage=void 0,this._screenSharingBg=void 0,this._interval=-1,this._scale=1}b.prototype=Object.create(a.Renderer.ContentSharingRenderer.prototype),b.prototype.drawFrame=function(b){this._width!==b.getWidth()&&b.getWidth()>0&&(this._drawingStage.setWidth(b.getWidth()),this._zoomStage.setWidth(b.getWidth()*this._scale),this._width=b.getWidth(),this._state===a.Renderer.Konva.KonvaContentSharingState.PAUSED&&this._redrawPauseLayer()),this._height!==b.getHeight()&&b.getHeight()>0&&(this._drawingStage.setHeight(b.getHeight()),this._zoomStage.setHeight(b.getHeight()*this._scale),this._height=b.getHeight(),this._state===a.Renderer.Konva.KonvaContentSharingState.PAUSED&&this._redrawPauseLayer());var c=b.getBitmaps().map(this._generateImage.bind(this));$.when.apply(this,c).then(this._drawReceivedFrame.bind(this))},b.prototype._drawReceivedFrame=function(){if(this._state!==a.Renderer.Konva.KonvaContentSharingState.STOPPED){this._drawingLayer.draw();var b=this._getImageFromLayer(this._drawingLayer);this._mainLayer.removeChildren(),this._mainLayer.add(b),this._mainLayer.draw(),b=this._getImageFromLayer(this._mainLayer),this._drawingLayer.removeChildren(),this._drawingLayer.add(b),b=this._getImageFromLayer(this._mainLayer),this._zoomLayer.removeChildren(),this._zoomLayer.add(b),this._zoomLayer.draw()}},b.prototype._getImageFromLayer=function(a){var b=a.getCanvas();return new Konva.Image({x:0,y:0,image:b._canvas})},b.prototype._onImageLoaded=function(a,b,c){var d=new Konva.Image({x:a.getXOffset(),y:a.getYOffset(),image:b,width:a.getWidth(),height:a.getHeight()});this._drawingLayer.add(d),c.resolve(),window.URL.revokeObjectURL(b.src)},b.prototype._generateImage=function(a){var b=new Image,c=$.Deferred();return b.onload=function(){this._onImageLoaded(a,b,c)}.bind(this),b.src=a.getBlobData(),c.promise()},b.prototype.showCursor=function(a){var b=new Konva.Tween({node:this._cursor,duration:.1,easing:Konva.Easings.EaseIn,x:a.getX(),y:a.getY(),onFinish:function(){b.destroy()}});b.play()},b.prototype.stop=function(){this._mainLayer.destroyChildren(),this._drawingLayer.destroyChildren(),this._zoomLayer.destroyChildren(),this._cursorLayer.destroyChildren(),this._pauseLayer.destroyChildren(),this._width=0,this._height=0,this._drawingStage&&(this._drawingStage.destroyChildren(),this._drawingStage.setWidth(0),this._drawingStage.setHeight(0),this._drawingStage.draw(),this._drawingStage.destroy(),this._drawingStage=void 0),this._zoomStage&&(this._zoomStage.destroyChildren(),this._zoomStage.setWidth(0),this._zoomStage.setHeight(0),this._zoomStage.draw(),this._zoomStage.destroy(),this._zoomStage=void 0),$(this._screenSharingBg).remove(),this._screenSharingBg=void 0,this._state=a.Renderer.Konva.KonvaContentSharingState.STOPPED},b.prototype.start=function(b){var c=document.createElement("div");c.setAttribute("id",b+"-bg"),c.classList.add("hide"),this._screenSharingBg=c,$("#"+b).parent().append(c),this._drawingStage=new Konva.Stage({container:b+"-bg",width:this._width,height:this._height}),this._zoomStage=new Konva.Stage({container:b,width:this._width,height:this._height}),this._zoomStage.scale({x:this._scale,y:this._scale}),this._drawingStage.add(this._drawingLayer),this._drawingStage.add(this._mainLayer),this._zoomStage.add(this._zoomLayer),this._zoomStage.add(this._cursorLayer),this._zoomStage.add(this._pauseLayer),this._cursor=new Konva.Circle({x:-10,y:-10,radius:5,fill:"#EF5353"}),this._cursorLayer.add(this._cursor),this._state=a.Renderer.Konva.KonvaContentSharingState.STARTED,this._mainLayer.destroyChildren(),this._zoomLayer.destroyChildren(),this._drawingStage.draw(),this._zoomStage.draw()},b.prototype.pause=function(){this._state=a.Renderer.Konva.KonvaContentSharingState.PAUSED,this._drawingStage.getWidth()>0?this._redrawPauseLayer():this._contentSharing.isSharingApplicationWindow()||this._contentSharing.isSharingFullScreen()||(this._width=800,this._height=600,this._drawingStage.setWidth(this._width),this._drawingStage.setHeight(this._height),this._zoomStage.setWidth(this._width*this._scale),this._zoomStage.setHeight(this._height*this._scale),this._redrawPauseLayer())},b.prototype._redrawPauseLayer=function(){this._pauseLayer.removeChildren();var a=new Konva.Rect({x:0,y:0,opacity:.1,width:this._drawingStage.getWidth(),height:this._drawingStage.getHeight(),fill:"#00897b"});this._pauseLayer.add(a);var b=20,c=80,d=10,e=new Konva.Rect({x:this._drawingStage.getWidth()/2-b-d,y:(this._drawingStage.getHeight()-c)/2,width:b,height:c,fill:"#00897b"});this._pauseLayer.add(e);var f=new Konva.Rect({x:this._drawingStage.getWidth()/2+d,y:(this._drawingStage.getHeight()-c)/2,width:b,height:c,fill:"#00897b"});this._pauseLayer.add(f),this._zoomStage.draw()},b.prototype.unpause=function(){this._state=a.Renderer.Konva.KonvaContentSharingState.STARTED,this._pauseLayer.removeChildren(),this._zoomStage.draw()},b.prototype.zoom=function(a){if(a<=0)throw new Error("Scale cannot be lower than 0.");this._scale=a,this._zoomStage.height(this._height*this._scale),this._zoomStage.width(this._width*this._scale),this._zoomStage.scale({x:this._scale,y:this._scale}),this._zoomStage.draw()},b.prototype.autoFit=function(a,b){var c;return c=this._width*b/this._height<a?b/this._height:a/this._width,this.zoom(c),c},a.Renderer.Konva.KonvaContentSharingRenderer=b}(AvayaClientServices),function(a){"use strict";var b={STARTED:"STARTED",STOPPED:"STOPPED",PAUSED:"PAUSED"};a.Renderer.Konva.KonvaContentSharingState=b}(AvayaClientServices),function(){"use strict";function a(){}a.prototype={convertRectangle:function(a){var b,c="",d=!!a.attrs.fill,e=!0,f=this._colorHexToInt(d?a.attrs.fill:a.attrs.stroke),g=a.attrs.strokeWidth||0,h=new AvayaClientServices.Services.Collaboration.Shape(c,d,e,f,b,g);return h.addMovePoint(new AvayaClientServices.Services.Collaboration.Point(a.attrs.x,a.attrs.y)),h.addLinePoint(new AvayaClientServices.Services.Collaboration.Point(a.attrs.x+a.attrs.width,a.attrs.y)),h.addLinePoint(new AvayaClientServices.Services.Collaboration.Point(a.attrs.x+a.attrs.width,a.attrs.y+a.attrs.height)),h.addLinePoint(new AvayaClientServices.Services.Collaboration.Point(a.attrs.x,a.attrs.y+a.attrs.height)),h.addLinePoint(new AvayaClientServices.Services.Collaboration.Point(a.attrs.x,a.attrs.y)),h.finishDrawing(),h},convertEllipse:function(a){var b,c=new AvayaClientServices.Services.Collaboration.Point(a.attrs.x-a.attrs.radiusX,a.attrs.y-a.attrs.radiusY),d=new AvayaClientServices.Services.Collaboration.Point(a.attrs.x+a.attrs.radiusX,a.attrs.y+a.attrs.radiusY),e="",f=!!a.attrs.fill,g=!0,h=this._colorHexToInt(f?a.attrs.fill:a.attrs.stroke),i=a.attrs.strokeWidth||0;return new AvayaClientServices.Services.Collaboration.Circle(c,d,e,f,g,h,b,i)},convertText:function(a){var b=a.attrs.text,c=a.attrs.fontSize,d="",e=!0,f=!0,g=this._colorHexToInt(a.attrs.fill),h=new AvayaClientServices.Services.Collaboration.WhiteboardText(b,c,d,e,f,g);return h.setPosition(new AvayaClientServices.Services.Collaboration.Point(a.attrs.x,a.attrs.y)),h},convertLine:function(a){var b,c="",d=!1,e=!0,f=this._colorHexToInt(a.attrs.stroke),g=a.attrs.strokeWidth||0,h=new AvayaClientServices.Services.Collaboration.Shape(c,d,e,f,b,g);return h.addMovePoint(new AvayaClientServices.Services.Collaboration.Point(a.attrs.points[0],a.attrs.points[1])),h.addLinePoint(new AvayaClientServices.Services.Collaboration.Point(a.attrs.points[2],a.attrs.points[3])),h.finishDrawing(),h},convertPolygon:function(a,b){var c="",d=!!a.attrs.fill,e=!0,f=this._colorHexToInt(d?a.attrs.fill:a.attrs.stroke),g=a.attrs.strokeWidth||0,h=100*a.attrs.opacity,i=new AvayaClientServices.Services.Collaboration.Shape(c,d,e,f,h,g);i.addMovePoint(new AvayaClientServices.Services.Collaboration.Point(a._modelStart.x,a._modelStart.y));var j=0;for(j;j<a._modelRelativePoints.length;j++){var k=a._modelRelativePoints[j];0!==k.x&&0!==k.y&&i.addLinePoint(new AvayaClientServices.Services.Collaboration.Point(a._modelStart.x+k.x,a._modelStart.y+k.y))}return b&&i.finishDrawing(),i},_colorHexToInt:function(a){return"#"===a[0]?parseInt("0x".concat(a.slice(1))):parseInt("0x".concat(a))}},AvayaClientServices.Renderer.Konva.KonvaWhiteboardConverter=a}(),function(a){"use strict";function b(){a.Services.Collaboration.WhiteboardRenderer.call(this),this._width=800,this._height=600,this._scale=1,this._drawingStage=void 0,this._drawingLayer=void 0,this._canvas=void 0,this._mode=a.Services.Collaboration.WhiteboardToolModes.STROKE,this._color="#211e1e",this._strokeWidth=6,this._whiteboardConverter=new a.Renderer.Konva.KonvaWhiteboardConverter,this._whiteboardTools=new a.Renderer.Konva.KonvaWhiteboardTools(this),this._tool=this._whiteboardTools[a.Services.Collaboration.WhiteboardToolTypes.RECTANGLE],this._isDrawing=!1,this._fontSize=19,this._annotatedShape=void 0,this._inputExists=!1}function c(a,b){function c(a,b,c){var d={};d.gradient=(a.point.getY()-b.point.getY())/(a.point.getX()-b.point.getX()),d.interceptY=a.point.getY()-d.gradient*a.point.getX();var e=c.point.getY()===d.gradient*c.point.getX()+d.interceptY,f=a.point.getX()===b.point.getX()&&b.point.getX()===c.point.getX()||a.point.getY()===b.point.getY()&&b.point.getY()===c.point.getY();return e&&(1===d.gradient||d.gradient===-1)||f}if(a.length>1){var d=a.length-2,e=a.length-1;c(a[d],a[e],b)&&a.splice(e,1)}}b.prototype=Object.create(a.Services.Collaboration.WhiteboardRenderer.prototype),b.prototype.start=function(b){this._setupWhiteboard(b),this._canvas=document.getElementById(b).getElementsByClassName("konvajs-content")[0].getElementsByTagName("canvas")[0],this._canvas.onmousedown=function(b){if(!this._whiteboard.getDrawingCapability().isAllowed)return a.Base.Logger.warn(a.Base.LoggerTags.COLLABORATION_SERVICE,"It is not possible to use any whiteboard tool since whiteboard is not available at the moment."),!1;switch(this._tool.type){case a.Services.Collaboration.WhiteboardToolTypes.SELECTION:return;case a.Services.Collaboration.WhiteboardToolTypes.RECTANGLE:return void this._dragTool(b);case a.Services.Collaboration.WhiteboardToolTypes.CIRCLE:return void this._dragTool(b);case a.Services.Collaboration.WhiteboardToolTypes.MARKER:return void this._liveTool(b);case a.Services.Collaboration.WhiteboardToolTypes.PEN:return void this._liveTool(b);case a.Services.Collaboration.WhiteboardToolTypes.LINE:return void this._dragTool(b);case a.Services.Collaboration.WhiteboardToolTypes.STAMP:return void this._stampTool(b);case a.Services.Collaboration.WhiteboardToolTypes.TEXT:return void this._textTool(b);case a.Services.Collaboration.WhiteboardToolTypes.DELETE:return void this._deleteShape(b);case a.Services.Collaboration.WhiteboardToolTypes.CLEAR:return}}.bind(this)},b.prototype.end=function(a){this._drawingLayer&&(this._canvas.onmousedown=void 0,this._drawingLayer.destroyChildren(),this._drawingStage.destroyChildren(),this._drawingLayer.destroy(),this._drawingStage.destroy(),document.getElementById(a).innerHTML="",this._drawingLayer=void 0,this._drawingStage=void 0)},b.prototype.drawShape=function(b){if(this._drawingLayer){var c;if(this._drawingLayer.children.filter(function(a){return a.id===b.getId()}).length){var d=this._whiteboard.getActiveSurface().getShapes()[b.getId()];return void(a.Base.Utils.isDefined(d._ownerDisplayName)&&""!==d._ownerDisplayName||(d._ownerDisplayName=b.getOwnerDisplayName()))}if(b instanceof a.Services.Collaboration.Shape)c=this._createShape(b);else if(b instanceof a.Services.Collaboration.Circle)c=this._createCircle(b);else{if(!(b instanceof a.Services.Collaboration.WhiteboardText))return;c=this._createText(b)}this._drawingLayer.add(c),this._drawingLayer.draw()}},b.prototype.removeShape=function(a){this._getKonvaShape(a).destroy(),this._drawingLayer.draw()},b.prototype._deleteShape=function(a){var b=this._drawingLayer.getIntersection({x:a.offsetX,y:a.offsetY});if(null!==b){var c=this._getSDKShape(b);if(c.isMine())return this.removeShape(c),this._whiteboard.getActiveSurface().removeShape(c)}var d=$.Deferred();return d.reject(),d.promise()},b.prototype.updateShape=function(b){var c=this._getKonvaShape(b);b.getId()!==c.id&&(c.id=b.getId());var d,e;c instanceof Konva.Ellipse&&a.Base.Utils.isDefined(b.getTranslation())?(d=c.initX+b.getTranslation().getX(),e=c.initY+b.getTranslation().getY()):c instanceof Konva.Text&&a.Base.Utils.isDefined(b.getPosition())?(d=b.getPosition().getX()+b.getTranslation().getX(),e=b.getPosition().getY()+b.getTranslation().getY()):c instanceof Konva.Shape&&(a.Base.Utils.isDefined(b.getTranslation())?c instanceof Konva.Rect?(d=b.getPoints()[0].point.getX()+b.getTranslation().getX(),e=b.getPoints()[0].point.getY()+b.getTranslation().getY()):(d=b.getTranslation().getX(),e=b.getTranslation().getY()):c.attrs.sceneFunc=function(a){a.beginPath();for(var d=b.getPoints(),e=0;e<d.length;e++)d[e].isMove?a.moveTo(d[e].point.getX(),d[e].point.getY()):a.lineTo(d[e].point.getX(),d[e].point.getY());a.fillStrokeShape(c)}.bind(this)),a.Base.Utils.isDefined(d)&&a.Base.Utils.isDefined(e)&&c.position({x:d,y:e}),this._drawingLayer.draw()},b.prototype.clearContent=function(){if(a.Base.Utils.isDefined(this._drawingLayer)){for(var b=this._drawingLayer.children.length-1;b>=0;b--)this._drawingLayer.children[b].destroy();this._drawingLayer.draw()}},b.prototype.setTool=function(b,c){console.debug("Tool set: ",b,c),this._tool.type===a.Services.Collaboration.WhiteboardToolTypes.SELECTION&&this._drawingLayer&&this._unsetDraggable(),this._tool=this._whiteboardTools[b],c&&this._tool.modes[c]&&(this._mode=c),a.Base.Utils.isDefined(this._canvas)&&b!==a.Services.Collaboration.WhiteboardToolTypes.SELECTION&&b!==a.Services.Collaboration.WhiteboardToolTypes.DELETE&&(this._canvas.onmousemove=void 0,this._canvas.onmouseout=void 0,a.Base.Utils.isDefined(this._annotatedShape)&&(this._onShowShapeAnnotationCallbacks.fire(),this._annotatedShape=void 0)),!a.Base.Utils.isDefined(this._canvas)||b!==a.Services.Collaboration.WhiteboardToolTypes.SELECTION&&b!==a.Services.Collaboration.WhiteboardToolTypes.DELETE||(this._canvas.onmousemove=function(b){var c=this._drawingLayer.getIntersection({x:b.offsetX,y:b.offsetY});if(null!==c&&!a.Base.Utils.isDefined(this._annotatedShape)||null!==c&&a.Base.Utils.isDefined(this._annotatedShape)&&c._id!==this._annotatedShape._id){var d=this._getSDKShape(c);this._onShowShapeAnnotationCallbacks.fire(d),this._annotatedShape=c}else null===c&&a.Base.Utils.isDefined(this._annotatedShape)&&(this._onShowShapeAnnotationCallbacks.fire(),this._annotatedShape=void 0)}.bind(this),this._canvas.onmouseout=function(b){a.Base.Utils.isDefined(this._annotatedShape)&&(this._onShowShapeAnnotationCallbacks.fire(),this._annotatedShape=void 0)}.bind(this)),b===a.Services.Collaboration.WhiteboardToolTypes.SELECTION&&this._setDraggable(),b===a.Services.Collaboration.WhiteboardToolTypes.CLEAR&&this._clear()},b.prototype.setColor=function(a){console.debug("Color set: ",a),this._color=a},b.prototype.zoom=function(a){if(a<=0)throw new Error("Scale cannot be lower than 0.");this._scale=a,this._drawingLayer.scale({x:this._scale,y:this._scale}),this._drawingLayer.draw(),this._drawingStage.height(this._height*this._scale),this._drawingStage.width(this._width*this._scale)},b.prototype.autoFit=function(a,b){var c;return c=this._width*b/this._height<a?b/this._height:a/this._width,this.zoom(c),c},b.prototype._textTool=function(b){var c=document.getElementById("canvasTextInput");if(c){if(this._inputExists){var d=this._tool.endInput(b,this._canvas,c,this._scale);d.fill(this._color),d.fontSize(a.Services.Collaboration.WhiteboardTextSizes[this._mode]),d.fontStyle("bold"),this._drawingLayer.add(d),this._drawingLayer.draw(),this._convertAndAddShape(d,this._tool.name)}}else this._tool.startInput(b,this._canvas,this._mode,this._scale),this._inputExists=!0},b.prototype._dragTool=function(a){var b;this._isDrawing=!0,b=this._tool.startFunction(a,this._mode,this._scale);var c=function(a){this._isDrawing=!1,this._tool.endFunction(a),this._clearMouseEvents(),b.isMine=!0,this._convertAndAddShape(b,this._tool.name)}.bind(this);this._canvas.onmouseup=function(a){c(a)}.bind(this),this._canvas.onmouseleave=function(a){c(a)}.bind(this)},b.prototype._liveTool=function(b){var d;this._isDrawing=!0,d=this._tool.startFunction(b,this._scale);var e=this._whiteboardConverter.convertPolygon(d,!1),f=function(a){this._isDrawing=!1,this._tool.endFunction(a),this._clearMouseEvents(),d.isMine=!0,e.isFinished()||e.finishDrawing().done(function(a){this._updateShapeId(d,a)}.bind(this))}.bind(this);return this._canvas.onmousemove=function(b){this._tool.drawFunction(b,d);var f=new a.Services.Collaboration.Point(b.layerX/this._scale,b.layerY/this._scale);c(e.getPoints(),{point:f}),e.addLinePoint(f)}.bind(this),this._canvas.onmouseup=function(a){f(a)}.bind(this),this._canvas.onmouseleave=function(a){f(a)}.bind(this),this._whiteboard.getActiveSurface().addShape(e).done(function(a){this._updateShapeId(d,a)}.bind(this))},b.prototype._stampTool=function(a){var b;this._isDrawing=!0,b=this._tool.drawFunction(a,this._scale),b.isMine=!0,this._isDrawing=!1,this._convertAndAddShape(b,this._tool.name)},b.prototype._clear=function(){return this.clearContent(),this._whiteboard.getActiveSurface().clearContent()},b.prototype._createShape=function(b){var c=b.getPoints(),d=new Konva.Shape({fill:b.isFilled()?a.Base.Utils.colorIntToHex(b.getColor()):void 0,stroke:b.isFilled()?void 0:a.Base.Utils.colorIntToHex(b.getColor()),strokeWidth:b.isFilled()?void 0:b.getWidth(),lineCap:"round",lineJoin:"round",opacity:b.getAlpha()/100,sceneFunc:function(a){a.beginPath();var b,d=0;for(d;d<c.length;d++)b=c[d],b.isMove?a.moveTo(b.point.getX(),b.point.getY()):a.lineTo(b.point.getX(),b.point.getY());a.fillStrokeShape(this)}});return a.Base.Utils.isDefined(b.getTranslation())&&d.position({x:b.getTranslation().getX(),y:b.getTranslation().getY()}),this._addCommonData(b,d)},b.prototype._moveShape=function(b,c){var d=this._getSDKShape(b),e=c.newPositionX-c.selectionX,f=c.newPositionY-c.selectionY,g=d.getTranslation();a.Base.Utils.isDefined(g)?d.setTranslation(new a.Services.Collaboration.Point(g.getX()+e,g.getY()+f)):d.setTranslation(new a.Services.Collaboration.Point(e,f)),this._whiteboard.getActiveSurface().updateShape(d)},b.prototype._createCircle=function(b){var c=new Konva.Ellipse({x:b.getTopLeft().getX()+(b.getBottomRight().getX()-b.getTopLeft().getX())/2,y:b.getTopLeft().getY()+(b.getBottomRight().getY()-b.getTopLeft().getY())/2,radius:{x:(b.getBottomRight().getX()-b.getTopLeft().getX())/2,y:(b.getBottomRight().getY()-b.getTopLeft().getY())/2},fill:b.isFilled()?a.Base.Utils.colorIntToHex(b.getColor()):void 0,stroke:b.isFilled()?void 0:a.Base.Utils.colorIntToHex(b.getColor()),strokeWidth:b.isFilled()?void 0:b.getWidth()});return c.initX=c.attrs.x,c.initY=c.attrs.y,a.Base.Utils.isDefined(b.getTranslation())&&c.position({x:c.initX+b.getTranslation().getX(),y:c.initY+b.getTranslation().getY()}),this._addCommonData(b,c)},b.prototype._createText=function(b){var c=new Konva.Text({x:b.getPosition().getX(),y:b.getPosition().getY(),fill:a.Base.Utils.colorIntToHex(b.getColor()),text:b.getContent(),fontSize:b.getFontSize(),fontFamily:"Arial",lineHeight:1.25});return c.fontStyle("bold"),a.Base.Utils.isDefined(b.getTranslation())&&c.position({x:b.getPosition().getX()+b.getTranslation().getX(),y:b.getPosition().getY()+b.getTranslation().getY()}),this._addCommonData(b,c)},b.prototype._addCommonData=function(a,b){return b.id=a.getId(),b.ownerDisplayName=a.getOwnerDisplayName(),b.status=a.getStatus(),b.isMine=a.isMine(),b},b.prototype._setupWhiteboard=function(a){this._drawingStage&&this.end(a),this._drawingStage=new Konva.Stage({container:a,width:this._width,height:this._height}),this._drawingLayer=new Konva.Layer,this._drawingStage.add(this._drawingLayer),this.zoom(this._scale)},b.prototype._convertAndAddShape=function(a){var b;if(a instanceof Konva.Rect)return b=this._whiteboardConverter.convertRectangle(a),this._whiteboard.getActiveSurface().addShape(b).done(function(b){this._updateShapeId(a,b)}.bind(this));if(a instanceof Konva.Ellipse)return b=this._whiteboardConverter.convertEllipse(a),this._whiteboard.getActiveSurface().addCircle(b).done(function(b){this._updateShapeId(a,b)}.bind(this));if(a instanceof Konva.Line)return b=this._whiteboardConverter.convertLine(a),this._whiteboard.getActiveSurface().addShape(b).done(function(b){this._updateShapeId(a,b)}.bind(this));if(a instanceof Konva.Text)return b=this._whiteboardConverter.convertText(a),this._whiteboard.getActiveSurface().addText(b).done(function(b){this._updateShapeId(a,b)}.bind(this));if(a instanceof Konva.Shape){return b=this._whiteboardConverter.convertPolygon(a,!0),this._whiteboard.getActiveSurface().addShape(b).done(function(b){this._updateShapeId(a,b)}.bind(this))}},b.prototype._getKonvaShape=function(a){if(this._drawingLayer&&this._drawingLayer.children)for(var b=0;b<this._drawingLayer.children.length;b++)if(this._drawingLayer.children[b].id===a.getId()||this._drawingLayer.children[b].id===a._tempId)return this._drawingLayer.children[b]},b.prototype._getSDKShape=function(a){return this._whiteboard.getActiveSurface().getShapes()[a.id]},b.prototype._updateShapeId=function(a,b){a.id=b},b.prototype._setDraggable=function(){var a,b=this._drawingLayer.children;for(a=0;a<b.length;a++)b[a].isMine&&b[a].draggable(!0);this._drawingLayer.on("dragstart",function(a){this._tool.dragStart(a,this._scale)}.bind(this)),this._drawingLayer.on("dragend",function(a){this._tool.dragEnd(a,this._scale)}.bind(this)),this._drawingLayer.draw()},b.prototype._unsetDraggable=function(){var a,b=this._drawingLayer.children;for(a=0;a<b.length;a++)b[a].isMine&&b[a].draggable(!1);this._drawingLayer.off("dragstart"),this._drawingLayer.off("dragend"),this._drawingLayer.draw()},b.prototype._clearMouseEvents=function(){this._canvas.onmouseup=void 0,this._canvas.onmouseleave=void 0},a.Renderer.Konva.KonvaWhiteboardRenderer=b}(AvayaClientServices),function(){"use strict";function a(a){AvayaClientServices.Services.Collaboration.WhiteboardTools.call(this);var b=this[AvayaClientServices.Services.Collaboration.WhiteboardToolTypes.LINE],c=this[AvayaClientServices.Services.Collaboration.WhiteboardToolTypes.RECTANGLE],d=this[AvayaClientServices.Services.Collaboration.WhiteboardToolTypes.CIRCLE],e=this[AvayaClientServices.Services.Collaboration.WhiteboardToolTypes.STAMP],f=this[AvayaClientServices.Services.Collaboration.WhiteboardToolTypes.SELECTION],g=this[AvayaClientServices.Services.Collaboration.WhiteboardToolTypes.TEXT],h=this[AvayaClientServices.Services.Collaboration.WhiteboardToolTypes.MARKER],i=this[AvayaClientServices.Services.Collaboration.WhiteboardToolTypes.PEN];h.startFunction=function(b,c){var d=new Konva.Shape({stroke:a._color,strokeWidth:12,lineCap:"round",lineJoin:"round",opacity:.6,sceneFunc:function(a){a.beginPath();var b=0;for(a.moveTo(d._modelStart.x,d._modelStart.y),b;b<d._modelRelativePoints.length;b++)a.lineTo(d._modelRelativePoints[b].x/c,d._modelRelativePoints[b].y/c);a.fillStrokeShape(this)}});return d._modelStart={x:b.layerX/c,y:b.layerY/c},d._modelRelativePoints=[],a._drawingLayer.add(d),a._drawingLayer.draw(),d}.bind(this),h.drawFunction=function(b,c){c._modelRelativePoints.push({x:b.layerX,y:b.layerY}),a._drawingLayer.draw(),a._drawingStage.draw()},h.endFunction=function(){a._canvas.onmousemove=void 0}.bind(this),i.startFunction=function(b,c){var d=new Konva.Shape({stroke:a._color,strokeWidth:4,lineCap:"round",lineJoin:"round",opacity:1,sceneFunc:function(a){a.beginPath();var b=0;for(a.moveTo(d._modelStart.x,d._modelStart.y),b;b<d._modelRelativePoints.length;b++)a.lineTo(d._modelRelativePoints[b].x/c,d._modelRelativePoints[b].y/c);a.fillStrokeShape(this)}});return d._modelStart={x:b.layerX/c,y:b.layerY/c},d._modelRelativePoints=[],a._drawingLayer.add(d),a._drawingLayer.draw(),d}.bind(this),i.drawFunction=function(b,c){c._modelRelativePoints.push({x:b.layerX,y:b.layerY}),a._drawingLayer.draw(),a._drawingStage.draw()},i.endFunction=function(){a._canvas.onmousemove=void 0}.bind(this),g.endInput=function(b,c,d,e){var f=parseInt(d.style.fontSize.replace("px","")),g=new Konva.Text({x:parseInt(d.style.left)/e,y:parseInt(d.style.top)/e,text:d.value,fontFamily:"Arial",lineHeight:1.25,fontSize:f});return g.isMine=!0,g.fontStyle("bold"),a._inputExists=!1,d.parentNode.removeChild(d),g},g.startInput=function(b,c,d){function e(){h.position().top>$(c).height()-j&&h.css({top:h.position().top-j/2})}function f(a){var b="",d=h.val().split(" "),e=h.val(),f=d[d.length-1];h.position().top+h.height()<$(c).height()-j/2&&(b=d.length>1?e.slice(0,e.length-f.length)+"\n"+e.slice(e.length-f.length,e.length+1):e.slice(0,e.length-3)+"\n"+e.slice(e.length-3,e.length+1),h.val(b),h.attr("rows",a+1))}function g(){return h.position().left+h.width()>$(c).width()}var h=$("<textarea></textarea>"),i=20,j=40;h.attr("id","canvasTextInput"),h.attr("rows","1"),h.css({zIndex:101,fontWeight:"bold",fontSize:AvayaClientServices.Services.Collaboration.WhiteboardTextSizes[d]+"px",position:"absolute",top:b.layerY.toString()+"px",left:b.layerX.toString()+"px",overflow:"hidden",width:i,height:"initial",border:"1px rgb(106, 105, 105) solid",boxShadow:"0px 0px 1px 1px #009EFF",background:"white",borderRadius:"1px",marginTop:"-2px",whiteSpace:"nowrap",color:a._color}),$(c.parentNode).append(h),h.focus(),e(),h.keydown(function(a){var b,d=a.keyCode||a.which,e=parseInt(h.attr("rows"),10);if(this.scrollWidth>850&&(b=800-i),h.css({width:0}),h.css({width:h.val().length>0?b||this.scrollWidth+i:i}),g()&&(h.css({left:h.position().left-i}),h.width()+i/2>$(c).width()&&(h.css({left:0}),f(e))),13===d)h.position().top+h.height()<$(c).height()-j/2&&h.attr("rows",e+1);else if(8===d&&e>1){var k=h.val().split("\n");k[k.length-1]||h.attr("rows",e-1)}}),h.blur(function(b){a._textTool(b)})},f.dragStart=function(a,b){this._clickData={x:a.evt.layerX/b,y:a.evt.layerY/b}},f.dragEnd=function(b,c){a._moveShape(b.target,{selectionX:this._clickData.x,selectionY:this._clickData.y,newPositionX:b.evt.layerX/c,newPositionY:b.evt.layerY/c});this._clickData=void 0},b.startFunction=function(b,c,d){var e={x:b.layerX/d,y:b.layerY/d},f={x:b.layerX/d,y:b.layerY/d},g=new Konva.Line({points:[e.x,e.y,f.x,f.y],stroke:a._color,strokeWidth:AvayaClientServices.Services.Collaboration.WhiteboardLineWidths[c],lineCap:"round",lineJoin:"round"});return a._drawingLayer.add(g),a._drawingLayer.draw(),a._canvas.onmousemove=function(b){f.x=b.layerX/d,f.y=b.layerY/d,g.attrs.points=[e.x,e.y,f.x,f.y],a._drawingLayer.draw(),a._drawingStage.draw()}.bind(this),g}.bind(this),b.endFunction=function(b){a._canvas.onmousemove=void 0}.bind(this),c.startFunction=function(b,c,d){var e;return"FILLED"===c?e=new Konva.Rect({x:b.layerX/d,y:b.layerY/d,width:1,height:1,fill:a._color}):"STROKE"===c&&(e=new Konva.Rect({x:b.layerX/d,y:b.layerY/d,width:AvayaClientServices.Services.Collaboration.WhiteboardLineWidths.LARGE,height:1,lineCap:"round",lineJoin:"round",stroke:a._color,strokeWidth:a._strokeWidth})),a._drawingLayer.add(e),a._drawingLayer.draw(),a._canvas.onmousemove=function(b){e.width(b.layerX/d-e.attrs.x),e.height(b.layerY/d-e.attrs.y),a._drawingLayer.draw(),a._drawingStage.draw()}.bind(this),e}.bind(this),c.endFunction=function(b){a._canvas.onmousemove=void 0}.bind(this),d.startFunction=function(b,c,d){var e,f={x:b.layerX/d,y:b.layerY/d},g={x:b.layerX/d,y:b.layerY/d};return"FILLED"===c?e=new Konva.Ellipse({x:f.x+(g.x-f.x)/2,y:f.y+(g.y-f.y)/2,radius:{x:Math.abs(g.x-f.x)/2,y:Math.abs(g.y-f.y)/2},fill:a._color}):"STROKE"===c&&(e=new Konva.Ellipse({x:f.x+(g.x-f.x)/2,y:f.y+(g.y-f.y)/2,radius:{x:Math.abs(g.x-f.x)/2,y:Math.abs(g.y-f.y)/2},stroke:a._color,strokeWidth:a._strokeWidth})),a._drawingLayer.add(e),a._drawingLayer.draw(),a._canvas.onmousemove=function(b){g.x=b.layerX/d,g.y=b.layerY/d,e.radius({x:Math.abs(g.x-f.x)/2,y:Math.abs(g.y-f.y)/2}),e.x(f.x+(g.x-f.x)/2),e.y(f.y+(g.y-f.y)/2),e.initX=f.x+(g.x-f.x)/2,e.initY=f.y+(g.y-f.y)/2,a._drawingLayer.draw(),a._drawingStage.draw()}.bind(this),e}.bind(this),d.endFunction=function(b){a._canvas.onmousemove=void 0}.bind(this),e.drawFunction=function(b,c){var d={x:b.layerX/c,y:b.layerY/c},e=[{x:0,y:0},{x:-10,y:-10},{x:-42,y:-10},{x:-42,y:10},{x:-10,y:10}],f=new Konva.Shape({fill:a._color,sceneFunc:function(a){a.beginPath(),a.moveTo(d.x,d.y);var b=1;for(b;b<e.length;b++)a.lineTo(d.x+e[b].x,d.y+e[b].y);a.closePath(),a.fillStrokeShape(this)}});return f._modelStart=d,f._modelRelativePoints=e,a._drawingLayer.add(f),a._drawingLayer.draw(),a._drawingStage.draw(),f}.bind(this)}a.prototype=Object.create(AvayaClientServices.Services.Collaboration.WhiteboardTools.prototype),AvayaClientServices.Renderer.Konva.KonvaWhiteboardTools=a}();